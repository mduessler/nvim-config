#!/bin/sh

set -e

. ./scripts/log
. ./scripts/install-system-dependencies
. ./scripts/install-selene

install_lpeglabel() {
    if ! command -v lua >/dev/null 2>&1; then
        error "Lua not installed"
        return 1
    fi
    info "Installing 'lpeglabel"
    luarocks install lpeglabel --local
    success "Installed 'lpeglabel'"
}

install_nerd_fonts() {
    if [ "$1" = "--nerd-fonts" ]; then
        NERDPATH="${HOME}/.local/src"
        info "Installing nerd-fonts to '${NERDPATH}'"

        git clone https://github.com/ryanoasis/nerd-fonts "${NERDPATH}" || return 1
        cd "${NERDPATH}"
        chmod +x install.sh
        ./install.sh || exit 1
        success "Installed nerd-fonts."
        return 0
    fi
    info "Skipping nerd-fonts installation."
    info "Please install nerd-fonts (https://github.com/ryanoasis/nerd-fonts)."
    return 0
}

main() {

    if ! install_system_dependencies; then
        error "Stopping installation. Can't install system dependencies."
        exit 1
    fi
    if ! install_selene; then
        warning "Can not install selene. Continue ..."
    fi

    info "Installing lazy..."
    nvim --headless +qa

    info "Installing plugins ... "
    nvim --headless "+Lazy! sync" +qa

    if ! install_nerd_fonts "$1"; then
        warning "Could not install nerd-fonts. Continue..."
    fi
}

# main "$@"
